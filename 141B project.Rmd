---
title: "141B Proj"
author: "Isaiah Valencia"
date: "3/3/2020"
output: html_document
---

```{r setup, include=FALSE}
#install.packages('spotifyr', 'fmsb')
```


```{r }
library(spotifyr)
library(tidyverse)
library(knitr)
library(ggplot2)
library(fmsb)
library(shiny)
library(dplyr)
library("scales")
Sys.setenv(SPOTIFY_CLIENT_ID = 'f0d212500a7e4c74baaab9025ea186c3')
Sys.setenv(SPOTIFY_CLIENT_SECRET = '4985198dd20d47c7bdc5e52a1cf01e3f')
access_token <- get_spotify_access_token()
```


```{r , echo=FALSE}
beatles <- get_artist_audio_features('led zeppelin')
beatles
```

```{r}
beatles %>% 
    count(key_mode, sort = TRUE) %>% 
    head(5) %>% 
    kable()
beatles
```




```{r}
###Get the data on the artists and compile them to one data frame
artistnames <- c('Post Malone','Ariana Grande','Billie Eilish','Khalid','Drake','Travis Scott','Ed Sheeran',
            'Taylor Swift', 'Halsey')
data <- get_artist_audio_features('Post Malone')
for (i in 2:length(artists)){
  data_new <- get_artist_audio_features(artistnames[i])
  data <- bind_rows(data, data_new)
}


ui <- fluidPage(
  
  titlePanel("Test"),
  
  sidebarLayout(
    sidebarPanel(
      selectInput(inputId = "artists", label = "Artist: ", choices = artistnames, multiple =F)
    ),
    
    
    mainPanel(plotOutput("radarPlot"))
  ))

server <- function(input, output) {

  output$radarPlot <- renderPlot({
    artist_radar <- data %>% filter(artist_name == input$artists) %>% 
      select(danceability,  energy, acousticness, valence, loudness) %>% 
      as.data.frame() %>% mutate(loudness = (mean(loudness) / (-60))) %>% 
      summarize(mean(danceability), mean(energy), mean(acousticness), mean(valence), mean(loudness)) 
  artist_radar <- rbind(rep(1,6) , rep(0,6) , artist_radar) # 1 is the upper bound and 0 is the lower
  colnames(artist_radar) = c('Danceability', 'Energy', 'Acousticness', 'Valence', 'loudness') 
  radarchart(artist_radar, axistype=1, 
             #custom polygon
             pcol=rgb(0.2,0.5,0.5,0.9) , pfcol=rgb(0.2,0.5,0.5,0.5) , plwd=1 , 
             #custom the grid
             cglcol="grey", cglty=1, axislabcol="grey", caxislabels=seq(0,1,5), cglwd=0.8,
             #custom labels
             vlcex=0.8 )
             
  })
  
}

shinyApp(ui = ui, server = server)

```


